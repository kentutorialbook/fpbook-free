= 「値と演算」と「関数と定義域」のはなし　型は集合 Types as Sets
ifndef::stem[:stem: latexmath]
ifndef::imagesdir[:imagesdir: ../img/]
ifndef::source-highlighter[:source-highlighter: highlightjs]
ifndef::highlightjs-theme:[:highlightjs-theme: tomorrow-night]
ifndef::icons[:icons: font]

++++
<style type="text/css">
p >code {background-color: #aaaaaa};　
td >code {background-color: #aaaaaa};
</style>
++++

== 値と演算はペア

結合性がある二項演算で

stem:[1 + 2 + 3 = 6]

stem:[レゴブロックA + レゴブロックB + レゴブロックC = レゴブロックABC]
　　
stem:[USB機器 + USB機器 + USB機器 = USB機器]

stem:[文字列 + 文字列 + 文字列 = 文字列]

と色々なモノイドが考えられるわけですが、ここで `+` と表現している二項の中置演算子ですが、同じ記号でも実際やってることはまるで違う！というのはわかります。

`+` という**演算子は、値に紐付いたペアの片割れで値と切り離せません**。

image::1-12-2020-08-40-10-AM.png[]

こういう二項演算で、値と演算子のペア、そして結合性があるし、ついでに単位元という存在もある、という縛りもふくめて、モノイドと呼びます。


演算子の正体が突き詰めると、2つの引数をとる関数である、

image::1-12-2020-20-50-38-PM.png[]

ということを思い出すと、これはどういうことなのか？

== 型とは集合のこと Types as Sets

関数型プログラミングの根幹のパーツは関数ですが、それは集合論の写像と同じものである、というのは _🟧 **UNIT 3 : 数学 Mathematics**参照_

image::2-7-2020-13-35-58-PM.png[]

集合 stem:[X] の各要素 stem:[x] に +
集合 stem:[Y] の1つの要素 stem:[y] を対応させる規則を +
stem:[X]からstem:[Y]への写像と呼びます。

[width=80%, cols="h,d,d"]
|================
|オブジェクト指向|オブジェクト(object)|メソッド(method)
|代数学|値(value)|演算(operation)
|解析学|定義域/始集合/終集合(domain/codomain)値域(range)|関数(function)
|集合論|集合(set) 始集合/終集合(domain/codomain) | 写像(map)
|型理論|型(type) | 関数(function)/写像(map)
|圏論|対象(object)/圏(category) | 射(morphism)
|================

この中で一番ゆるく、あんまり何にも考えておらずテキトーなせいで混乱しまくっている枠組みがオブジェクト指向なのですが、すでに「オブジェクト指向と二項演算の意外な関係性」として見たように、根源的には代数構造の二項演算と呼応しています。

この中で、圏論(category theory)がもっとも根源的な枠組みとなります。 +
数学はかつては集合論を基礎として構築されていましたが、現代では圏論を基礎として再構築されようとしています。

先に集合論があり、その抽象度をさらにあげて一般化したものが圏論です。 +
集合論は、圏論で記述することができて、それは、link:https://ja.wikipedia.org/wiki/%E9%9B%86%E5%90%88%E3%81%AE%E5%9C%8F[集合の圏](category of sets)と言います。

関数型プログラミングの範囲は、射(morphism)が写像・関数になっているという集合の圏=集合論です。

この場合、定義域/始集合(domain) stem:[X]とその要素であるstem:[x]について　 +
`x` は `X` 型の値 +
`x:X`

また、終集合(codomain) stem:[Y]とその要素であるstem:[y]について　 +
`y` は `Y` 型の値 +
`y:Y`

と表現します。

== Type theory versus set theory

https://ncatlab.org/nlab/show/type+theory#type_theory_versus_set_theory

[quote]

----
Alternately, we could change our terminology so that what we have been calling “types” are instead called “sets”.

あるいは、これまで「型」と呼んでいたものを「集合」と呼ぶように用語を変更することもできます。
----

[quote]

----
Thus, words like “type” and “set” and “class” are really quite fungible. This sort of level-switch is especially important when we want to study the mathematics of type theory,

このように、「型」や「集合」や「クラス」などの言葉は、実はかなり代替可能です。このようなレベルの切り替えは、型理論の数学、つまり型理論の数学を研究するときには特に重要です。。
----


== Types as Sets

https://guide.elm-lang.org/appendix/types_as_sets.html

これは、TypeScriptではなく、link:https://elm-lang.org/[Elm]言語のドキュメントなのですが、概念自体は全く同一で、解説されている内容はとても有用です。

[quote]

----

Elmプログラミングで最も重要なテクニックの一つは、コード内の値を実際に有効な値と正確に一致させることです。これでは無効なデータを残す余地がないので、私は常にカスタム型やデータ構造に注目することを推奨しています。

この目的を追求するにあたって、型（types）と集合(sets)の関係を理解しておくことが役立つことを私は発見しました。余計なことのように聞こえますが、それは貴方のマインドセットの形成に本当に役立つのです！

「型（types）を集合(sets)として」考えると、重要なクラスのバグ、つまり無効なデータを説明するのに役立ちます。

型をこのようなセットとして考えることは、言語が「簡単」、「制限的」、または「エラーが発生しやすい」と感じる理由を説明するのにも役立ちます。　
----

本書の目的は関数型プログラミングの概念の解説であり、関数は集合論の写像のことであり、**集合(Sets)こそがプログラミング世界で便利に利用されている型(Types)の正体である**と理解することが役立つと紹介しました。

関数とその定義域(始域)と終域、また写像と集合論はセットの概念で本来バラバラに扱うのはおかしいので、関数型プログラミングでも、集合の定義＝値の型付けが重要です。

具体的な詳細は上記リンクから、英語が苦手な人はGoogle日本語翻訳が役立つでしょう。

TypeScriptの型システムの詳細については本書の現段階では踏み込みません。


== 巷によくある、よくわからない「型」の説明

ほとんどのプログラマーは、多かれ少なかれ「どうやらプログラミングの世界には「型」というもののあるなしが非常に大きな問題として議論になっているようだ」というところから「型」の概念に遭遇することでしょう。

JavaScriptはlink:https://ja.wikipedia.org/wiki/%E5%8B%95%E7%9A%84%E5%9E%8B%E4%BB%98%E3%81%91[動的型付け]言語（dynamically typed language）です。


[quote]

----
プログラムにおいて、変数や、サブルーチンの引数や返り値などの値について、その型を、コンパイル時などそのプログラムの実行よりも前にあらかじめ決めるということをせず、実行時の実際の値による、という型システムの性質のことである。
----


image::0-10-2020-08-06-33-AM.png[]

link:https://www.typescriptlang.org/[TypeScript]は、link:https://ja.wikipedia.org/wiki/%E9%9D%99%E7%9A%84%E5%9E%8B%E4%BB%98%E3%81%91[静的型付け]言語（statically typed language）です。

[quote]

----
プログラムにおいて、変数や、サブルーチンの引数や返り値などの値について、その型が、コンパイル時など、そのプログラムの実行よりも前にあらかじめ決められている、という型システムの性質のことである。
----

現代のJavaScriptは強い型付けされた上位互換のTypeScriptとして、よりバグの混入のない関数型プログラミング言語として真価を発揮します。

では、その素晴らしい「型」というものは何なのか？Wikipediaなどで調べてみると、

link:https://ja.wikipedia.org/wiki/%E5%9E%8B%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0[型システム]

[quote]

----
型システム（英: type system）は、プログラミング言語において様々な法則から構成される論理体系であり、プログラム内の構成要素に型（type）と呼ばれるプログラム概念を付与する仕組みである。構成要素とは基本的な値（value）の他、変数、式、関数、オブジェクト、モジュールなどを指している。型の付与は主にデータの分類を成立させてデータ型を表現する他、データと暗黙情報を共に内包したデータ構造を形式化する。型システムの意義は、プログラム要素を分類し、各分類の識別法則の一貫性および各分類間の関連法則の整合性を保証して、プログラムエラーの発生を抑止することにある。型システムは、数理論理学の型理論に基づいて構築されたプログラミング用の形式手法である。
----

初学者というか多くの、ほとんどのプログラマーが「型」とは何か？と概念を習得したいときに、この説明でわかるとは到底思えません。

巷にあふれる「型の説明」とは、おぼろげに見えるような景色をスケッチしているようなもので、実際はなんの説明にもなっていないことがほとんどです。説明している人たちが自分が何を言っているのかよくわかっていないからです。

